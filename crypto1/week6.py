import binascii
import gmpy2
from gmpy2 import mpz
from gmpy2 import mpfr
from gmpy2 import mul
from gmpy2 import isqrt
from gmpy2 import add
from gmpy2 import sub
from gmpy2 import div

def Q1Q4():
    N = mpz('17976931348623159077293051907890247336179769789423065727343008115\
    77326758055056206869853794492129829595855013875371640157101398586\
    47833778606925583497541085196591615128057575940752635007475935288\
    71082364994994077189561705436114947486504671101510156394068052754\
    0071584560878577663743040086340742855278549092581')

    A = isqrt(N) + 1
    x = isqrt(sub(mul(A, A), N))

    p = sub(A, x)
    q = add(A, x)

    print("Q1:")
    print(p)

    fiN = mul(sub(p, 1), sub(q, 1))
    e = mpz(65537)
    d = gmpy2.invert(e, fiN)
    ct = mpz('22096451867410381776306561134883418017410069787892831071731839143\
            67613560012053800428232965047350942434394621975151225646583996794\
            28894607645420405815647489880137348641204523252293201764879166664\
            02997509188729971690526083222067771600019329260870009579993724077\
            458967773697817571267229951148662959627934791540')
    pt = gmpy2.powmod(ct, d, N)
    ptstr = pt.digits(16)
    pos = ptstr.find('00')
    payload = ptstr[pos + 2:]
    
    print("Q4:")
    print(binascii.unhexlify(payload))


def Q2():
    N = mpz('6484558428080716696628242653467722787263437207069762630604390703787\
    9730861808111646271401527606141756919558732184025452065542490671989\
    2428844841839353281972988531310511738648965962582821502504990264452\
    1008852816733037111422964210278402893076574586452336833570778346897\
    15838646088239640236866252211790085787877')

    for d in range(1, 1<<20):
        A = isqrt(N) + d
        x = isqrt(sub(mul(A, A), N))

        p = sub(A, x)
        q = add(A, x)

        if mul(p, q) == N:
            print("Q2:")
            print(p)
            break

def Q3():
    N = mpz('72006226374735042527956443552558373833808445147399984182665305798191\
    63556901883377904234086641876639384851752649940178970835240791356868\
    77441155132015188279331812309091996246361896836573643119174094961348\
    52463970788523879939683923036467667022162701835329944324119217381272\
    9276147530748597302192751375739387929')

    A = isqrt(mul(6, N)) + 1
    # (3 * p + 2 * q) / 2 is not an integer. or, A - 0.5 = (3p + 2q) / 2
    # so, x = sqrt((A-0.5)^2 - 6N) = sqrt(A^2 - A + 0.25 - 6N). the 0.25 term can be thrown away.
    x = isqrt(sub(sub(mul(A, A), A), mul(6, N)))
    p = div(sub(A, x), 3)
    q = div(add(A, x), 2)

    if mul(p, q) == N:
        print("Q3:")
        print(p)

Q1Q4()
Q2()
Q3()

